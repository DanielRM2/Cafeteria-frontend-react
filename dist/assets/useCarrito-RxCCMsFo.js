import{r as s}from"./index-CmXrzbuy.js";async function h(i){const e=await fetch(`http://localhost:8080/api/inventario/${i}`);if(!e.ok)throw new Error("Error al consultar inventario");return(await e.json()).cantidadDisponible}function p(){const[i,e]=s.useState(()=>{const o=localStorage.getItem("carrito");return o?JSON.parse(o):[]}),[n,d]=s.useState({});s.useEffect(()=>{async function o(){const t={};for(const a of i)try{const c=await h(a.idProducto);t[a.idProducto]=c}catch{t[a.idProducto]=0}d(t)}i.length>0?o():d({})},[i]),s.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(i))},[i]);const u=o=>{e(t=>{const a=t.find(r=>r.idProducto===o.idProducto),c=n[o.idProducto]??99;return a?a.cantidad+1>c?(alert(`Solo hay ${c} unidades disponibles para este producto.`),t):t.map(r=>r.idProducto===o.idProducto?{...r,cantidad:r.cantidad+1}:r):c<1?(alert("Producto sin stock disponible."),t):[...t,{...o,cantidad:1}]})},l=o=>{e(t=>t.filter(a=>a.idProducto!==o))},f=(o,t)=>{const a=n[o]??99;if(!isNaN(t)){if(t<=0){e(c=>c.filter(r=>r.idProducto!==o));return}if(t>a){alert(`Solo hay ${a} unidades disponibles para este producto.`);return}e(c=>c.map(r=>r.idProducto===o?{...r,cantidad:t}:r))}},S=()=>e([]),k=i.reduce((o,t)=>o+t.precio*t.cantidad,0),P=i.reduce((o,t)=>o+t.cantidad,0);return{carrito:i,agregarAlCarrito:u,eliminarDelCarrito:l,actualizarCantidad:f,limpiarCarrito:S,totalCarrito:k,cantidadTotal:P,stockMap:n}}export{p as u};

import{u as N,r as i,j as e}from"./index-CmXrzbuy.js";function k(){const{cliente:n,cerrarSesion:l}=N(),[a,d]=i.useState(null),[b,t]=i.useState(!1),[o,h]=i.useState({nombreCompleto:"",correo:"",telefono:"",contrasena:""}),[c,m]=i.useState(null),[r,x]=i.useState(!1);i.useEffect(()=>{n&&(d(n),h({nombreCompleto:n.nombreCompleto||"",correo:n.correo||"",telefono:n.telefono||"",contrasena:""}))},[n]),i.useEffect(()=>{if(c){const u=setTimeout(()=>m(null),5e3);return()=>clearTimeout(u)}},[c]);const p=u=>{h({...o,[u.target.name]:u.target.value})},j=()=>{t(!0),m(null)},g=()=>{t(!1),h({nombreCompleto:a.nombreCompleto||"",correo:a.correo||"",telefono:a.telefono||"",contrasena:""}),m(null)},y=()=>o.nombreCompleto!==a.nombreCompleto||o.correo!==a.correo||o.telefono!==a.telefono||o.contrasena&&o.contrasena.trim()!=="",v=async u=>{if(u.preventDefault(),!y()){m({tipo:"error",texto:"No has realizado ningún cambio."});return}try{const s={...o};s.contrasena||delete s.contrasena;const f=await fetch(`http://localhost:8080/api/cliente/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!f.ok){const E=await f.json();throw new Error(E.error||"Error al actualizar perfil.")}const C=await f.json();d(C),t(!1),m({tipo:"exito",texto:"Perfil actualizado correctamente."})}catch(s){m({tipo:"error",texto:s.message||"Hubo un error al actualizar."})}},w=async()=>{try{if(!(await fetch(`http://localhost:8080/api/cliente/${a.id}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar cuenta");l(),window.location.href="/login"}catch{m({tipo:"error",texto:"Hubo un error al eliminar la cuenta."})}};return a?e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Mi Perfil"}),c&&e.jsx("div",{className:`mb-4 px-4 py-2 rounded transition-all duration-300 border
                        ${c.tipo==="exito"?"bg-green-100 text-green-800 border-green-300":"bg-red-100 text-red-800 border-red-300"}`,children:c.texto}),b?e.jsxs("form",{onSubmit:v,className:"bg-white rounded shadow p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Nombre completo"}),e.jsx("input",{name:"nombreCompleto",value:o.nombreCompleto,onChange:p,placeholder:"Ingrese su nombre completo",className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Correo"}),e.jsx("input",{name:"correo",type:"email",value:o.correo,onChange:p,placeholder:"ejemplo@correo.com",className:"w-full border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Teléfono"}),e.jsx("input",{name:"telefono",value:o.telefono,onChange:p,placeholder:"Número de celular",className:"w-full border rounded px-2 py-1",maxLength:9,pattern:"\\d{9}",inputMode:"numeric",title:"El número debe tener exactamente 9 dígitos",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block font-semibold mb-1",children:"Contraseña (opcional)"}),e.jsx("input",{name:"contrasena",type:"password",value:o.contrasena,onChange:p,placeholder:"Dejar vacío si no desea cambiar",className:"w-full border rounded px-2 py-1",minLength:"5"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Guardar"}),e.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",onClick:g,children:"Cancelar"})]})]}):e.jsxs("div",{className:"bg-white rounded shadow p-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Nombre:"})," ",a.nombreCompleto]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Correo:"})," ",a.correo]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Teléfono:"})," ",a.telefono]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",onClick:j,children:"Editar"}),e.jsx("button",{className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",onClick:()=>x(!0),children:"Eliminar cuenta"})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"¿Estás seguro?"}),e.jsx("p",{className:"mb-6",children:"¿Deseas eliminar tu cuenta? Esta acción no se puede deshacer."}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",children:"Cancelar"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Eliminar"})]})]})})]}):e.jsx("div",{children:"Cargando..."})}function M(){const{cliente:n}=N(),[l,a]=i.useState([]),[d,b]=i.useState({direccion:"",referencia:"",distrito:""}),[t,o]=i.useState(null),[h,c]=i.useState(""),[m,r]=i.useState(!1),[x,p]=i.useState(null);i.useEffect(()=>{n!=null&&n.id&&fetch(`http://localhost:8080/api/direcciones-cliente/cliente/${n.id}`).then(s=>s.json()).then(s=>a(s)).catch(()=>c("Error al cargar direcciones"))},[n]),i.useEffect(()=>{if(h){const s=setTimeout(()=>c(""),5e3);return()=>clearTimeout(s)}},[h]);const j=s=>{b({...d,[s.target.name]:s.target.value})},g=()=>b({direccion:"",referencia:"",distrito:""}),y=async s=>{s.preventDefault(),c("");try{const f={...d,idCliente:n.id},C=t?`http://localhost:8080/api/direcciones-cliente/${t}`:"http://localhost:8080/api/direcciones-cliente",S=await fetch(C,{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(!S.ok)throw new Error("Error al guardar dirección");const D=await S.json();t?(a(l.map(P=>P.idDireccion===t?D:P)),c("Dirección actualizada")):(a([...l,D]),c("Dirección agregada")),g(),o(null)}catch{c("No se pudo guardar la dirección")}},v=s=>{o(s.idDireccion),b({direccion:s.direccion,referencia:s.referencia||"",distrito:s.distrito||""}),c("")},w=s=>{p(s),r(!0)},u=async()=>{if(x)try{if(!(await fetch(`http://localhost:8080/api/direcciones-cliente/${x.idDireccion}`,{method:"DELETE"})).ok)throw new Error;a(l.filter(f=>f.idDireccion!==x.idDireccion)),c("Dirección eliminada")}catch{c("No se pudo eliminar")}finally{r(!1),p(null)}};return e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Mis Direcciones"}),h&&e.jsx("div",{className:"mb-4 px-4 py-2 bg-green-100 text-green-800 border border-green-300 rounded transition-all duration-300",children:h}),e.jsxs("form",{onSubmit:y,className:"bg-white rounded shadow p-4 mb-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"distrito",className:"mb-1 font-medium",children:"Distrito"}),e.jsx("input",{id:"distrito",name:"distrito",placeholder:"Ingrese el distrito",value:d.distrito,onChange:j,className:"border rounded px-2 py-1"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"direccion",className:"mb-1 font-medium",children:"Dirección"}),e.jsx("input",{id:"direccion",name:"direccion",placeholder:"Ingrese la dirección",value:d.direccion,onChange:j,className:"border rounded px-2 py-1",required:!0})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{htmlFor:"referencia",className:"mb-1 font-medium",children:"Referencia"}),e.jsx("input",{id:"referencia",name:"referencia",placeholder:"Ingrese una referencia",value:d.referencia,onChange:j,className:"border rounded px-2 py-1"})]})]}),e.jsxs("div",{className:"flex gap-4 mt-2",children:[e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:t?"Actualizar":"Agregar"}),t&&e.jsx("button",{type:"button",onClick:()=>{o(null),g()},className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",children:"Cancelar"})]})]}),e.jsxs("div",{className:"space-y-4",children:[l.length===0&&e.jsx("div",{children:"No tienes direcciones registradas."}),l.map(s=>e.jsxs("div",{className:"bg-white rounded shadow p-4 flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Distrito:"})," ",s.distrito||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Dirección:"})," ",s.direccion]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Referencia:"})," ",s.referencia||"-"]})]}),e.jsxs("div",{className:"flex gap-2 mt-2 md:mt-0",children:[e.jsx("button",{onClick:()=>v(s),className:"px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Editar"}),e.jsx("button",{onClick:()=>w(s),className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",children:"Eliminar"})]})]},s.idDireccion))]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"¿Estás seguro?"}),e.jsx("p",{className:"mb-6",children:"¿Deseas eliminar la dirección seleccionada?"}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>{r(!1),p(null)},className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",children:"Cancelar"}),e.jsx("button",{onClick:u,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Eliminar"})]})]})})]})}function T(){var h,c,m;const{cliente:n}=N(),[l,a]=i.useState([]),[d,b]=i.useState(""),[t,o]=i.useState(null);return i.useEffect(()=>{n!=null&&n.id&&fetch(`http://localhost:8080/api/pedidos/cliente/${n.id}`).then(r=>r.json()).then(r=>a(r)).catch(()=>b("Error al cargar pedidos"))},[n]),i.useEffect(()=>{if(d){const r=setTimeout(()=>b(""),5e3);return()=>clearTimeout(r)}},[d]),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Mis Pedidos"}),d&&e.jsx("div",{className:"mb-4 px-4 py-2 bg-red-100 text-red-800 border border-red-300 rounded transition-all duration-300",children:d}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsxs("table",{className:"min-w-[800px] text-sm bg-white rounded shadow",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-green-100 text-green-900",children:[e.jsx("th",{className:"py-2 px-4 text-left",children:"# Pedido"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Fecha Pedido"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Estado"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Método Entrega"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Dirección"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Total"}),e.jsx("th",{className:"py-2 px-4 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-4 text-center text-gray-500",children:"No tienes pedidos registrados."})}):l.map(r=>{var x;return e.jsxs("tr",{className:"border-b hover:bg-green-50",children:[e.jsx("td",{className:"py-2 px-4",children:r.idPedido}),e.jsx("td",{className:"py-2 px-4",children:r.fechaPedido?new Date(r.fechaPedido).toLocaleString():"-"}),e.jsx("td",{className:"py-2 px-4",children:r.estado}),e.jsx("td",{className:"py-2 px-4",children:r.metodoEntrega||"-"}),e.jsx("td",{className:"py-2 px-4",children:r.direccion||"-"}),e.jsxs("td",{className:"py-2 px-4",children:["S/ ",((x=r.total)==null?void 0:x.toFixed(2))??"-"]}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",onClick:()=>o(r),children:"Ver detalles"})})]},r.idPedido)})})]})}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded shadow-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("h4",{className:"text-xl font-bold mb-2",children:["Detalle del pedido #",t.idPedido]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Estado:"})," ",t.estado]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Método de entrega:"})," ",t.metodoEntrega]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Dirección:"})," ",t.direccion]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Fecha pedido:"})," ",t.fechaPedido?new Date(t.fechaPedido).toLocaleString():"-"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Fecha entrega:"})," ",t.fechaEntrega?new Date(t.fechaEntrega).toLocaleString():"-"]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Total:"})," S/ ",((h=t.total)==null?void 0:h.toFixed(2))??"-"]}),e.jsx("h5",{className:"font-semibold mt-4 mb-2",children:"Productos:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[600px] text-sm bg-gray-50 rounded",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-2 text-left",children:"Producto"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Cantidad"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Precio Unitario"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Subtotal"})]})}),e.jsx("tbody",{children:((c=t.detalles)==null?void 0:c.length)>0?t.detalles.map(r=>{var x,p;return e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2",children:r.nombreProducto}),e.jsx("td",{className:"py-1 px-2",children:r.cantidad}),e.jsxs("td",{className:"py-1 px-2",children:["S/ ",(x=r.precioUnitario)==null?void 0:x.toFixed(2)]}),e.jsxs("td",{className:"py-1 px-2",children:["S/ ",(p=r.subtotal)==null?void 0:p.toFixed(2)]})]},r.idDetallePedido)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-2 text-center text-gray-500",children:"Sin productos"})})})]})}),t.pago&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"font-semibold mt-4 mb-2",children:"Pago:"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Método:"})," ",t.pago.metodo]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Monto:"})," S/ ",(m=t.pago.monto)==null?void 0:m.toFixed(2)]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Estado:"})," ",t.pago.estado]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("b",{children:"Fecha pago:"})," ",t.pago.fechaPago?new Date(t.pago.fechaPago).toLocaleString():"-"]})]}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsx("button",{className:"px-4 py-2 bg-gray-300 rounded hover:bg-gray-400",onClick:()=>o(null),children:"Cerrar"})})]})})]})}function $(){const{cerrarSesion:n}=N(),[l,a]=i.useState("perfil"),d=()=>{switch(l){case"perfil":return e.jsx(k,{});case"direcciones":return e.jsx(M,{});case"pedidos":return e.jsx(T,{});default:return null}};return e.jsxs("div",{className:`flex flex-col md:flex-row h-[100vh]\r
            pt-[160px] sm:pt-[160px] md:pt-[160px] lg:pt-[120px] xl:pt-[120px]\r
            px-1 md:px-4 bg-gray-100 pb-[20px]`,children:[e.jsx("aside",{className:"md:w-1/4 w-full bg-white shadow md:rounded-l-lg p-0 md:p-4 border-r",children:e.jsxs("nav",{className:"flex md:flex-col flex-row",children:[e.jsx("div",{className:`boton-animado ${l==="perfil"?"activa":""}`,children:e.jsx("button",{className:`w-full text-left px-4 py-3 transition
                                ${l==="perfil"?"bg-green-200 font-bold text-green-900":"text-gray-700 hover:bg-green-100"}`,onClick:()=>a("perfil"),children:"👤 Mi perfil"})}),e.jsx("div",{className:`boton-animado ${l==="direcciones"?"activa":""}`,children:e.jsx("button",{className:`w-full text-left px-4 py-3 transition
                                ${l==="direcciones"?"bg-green-200 font-bold text-green-900":"text-gray-700 hover:bg-green-100"}`,onClick:()=>a("direcciones"),children:"🏠 Mis direcciones"})}),e.jsx("div",{className:`boton-animado ${l==="pedidos"?"activa":""}`,children:e.jsx("button",{className:`w-full text-left px-4 py-3 transition
                                ${l==="pedidos"?"bg-green-200 font-bold text-green-900":"text-gray-700 hover:bg-green-100"}`,onClick:()=>a("pedidos"),children:"🛒 Mis pedidos"})}),e.jsx("div",{className:"boton-animado",children:e.jsx("button",{className:"w-full text-left px-4 py-3 text-red-700 hover:bg-red-100 transition",onClick:()=>{n(),window.location.href="/login"},children:"🚪 Cerrar sesión"})})]})}),e.jsx("main",{className:"flex-1 bg-gray-50 p-6 rounded-b-lg md:rounded-l-none md:rounded-r-lg shadow",children:d()})]})}export{$ as default};

import{a as R,r as a,u as L,j as e}from"./index-CmXrzbuy.js";let v=0,b=null;function I(){const r=document.querySelectorAll(".carousel-item");function d(p){var i,l;const m=(p+r.length)%r.length;(i=r[v])==null||i.classList.remove("active"),v=m,(l=r[v])==null||l.classList.add("active")}function t(){d(v+1)}function g(p=8e3){b&&clearInterval(b),d(0),b=setInterval(t,p)}g()}function k(){R();const[r,d]=a.useState({email:"",password:""}),[t,g]=a.useState({nombreCompleto:"",email:"",password:"",telefono:""}),[p,m]=a.useState(!1),[i,l]=a.useState(""),[x,h]=a.useState("");return{datosLogin:r,setDatosLogin:d,datosRegistro:t,setDatosRegistro:g,manejarCambioLogin:n=>{d({...r,[n.target.name]:n.target.value})},manejarCambioRegistro:n=>{g({...t,[n.target.name]:n.target.value})},enviarLogin:async n=>{n.preventDefault(),l("");try{const s=await fetch("http://localhost:8080/api/cliente/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:r.email,contrasena:r.password})});if(s.ok){const o=await s.json();localStorage.setItem("token",o.token),localStorage.setItem("rol",o.rol||"CLIENTE"),localStorage.setItem("cliente",JSON.stringify(o.cliente)),window.location.href="/cuenta"}else{const o=await s.json();l(o.message||"Credenciales inválidas")}}catch(s){console.error("Error en login:",s),l("Error en la conexión al servidor")}},enviarRegistro:async n=>{n.preventDefault(),h(""),m(!1);try{const s=await fetch("http://localhost:8080/api/cliente/registro",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nombreCompleto:t.nombreCompleto,correo:t.email,contrasena:t.password,telefono:t.telefono})}),o=await s.json();if(s.ok)h("¡Registro exitoso! Ahora puedes iniciar sesión."),m(!0),g({nombreCompleto:"",email:"",password:"",telefono:""});else{let c="";typeof o=="string"?c=o:c=o.message||"Error al registrarse",c.includes("correo ya esta registrado")?h("El correo electrónico ya está registrado. Intenta con otro."):h(c)}}catch(s){console.error("Error en registro:",s),h("Error en la conexión al servidor")}},registroExitoso:p,setRegistroExitoso:m,mensajeLogin:i,setMensajeLogin:l,mensajeRegistro:x,setMensajeRegistro:h}}function q(){const r=R(),{cliente:d}=L(),[t,g]=a.useState(""),[p,m]=a.useState(!1),i=a.useRef(!1),{datosLogin:l,manejarCambioLogin:x,enviarLogin:h,datosRegistro:f,manejarCambioRegistro:j,enviarRegistro:N,registroExitoso:C,setRegistroExitoso:n,mensajeLogin:s,setMensajeLogin:o,mensajeRegistro:c,setMensajeRegistro:y}=k();a.useEffect(()=>{const u=localStorage.getItem("token"),E=localStorage.getItem("rol");u&&E==="CLIENTE"&&r("/cuenta")},[r]),a.useEffect(()=>{d&&r("/cuenta")},[d,r]),a.useEffect(()=>{I()},[]),a.useEffect(()=>{C&&(m(!1),n(!1),o("¡Registro exitoso! Ahora puedes iniciar sesión."),i.current=!1)},[C]),a.useEffect(()=>{if(s){const u=setTimeout(()=>o(""),3e3);return()=>clearTimeout(u)}},[s]),a.useEffect(()=>{if(c){const u=setTimeout(()=>y(""),3e3);return()=>clearTimeout(u)}},[c]);const S=u=>{i.current=!0,h(u)},w=u=>{i.current=!0,N(u)};return e.jsx("div",{children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"carousel",children:[e.jsx("div",{className:"carousel-item active",children:e.jsx("img",{src:"/images/carrusel/item1.jpg",alt:"item 1"})}),e.jsx("div",{className:"carousel-item",children:e.jsx("img",{src:"/images/carrusel/item2.jpg",alt:"item 2"})}),e.jsx("div",{className:"carousel-item",children:e.jsx("img",{src:"/images/carrusel/item3.jpg",alt:"item 3"})})]}),e.jsx("div",{className:"form-container",children:e.jsxs("div",{className:"form-inner",children:[e.jsxs("div",{className:`register-container ${p?"active":""}`,children:[c&&e.jsx("div",{className:`alerta-login ${c.includes("exitoso")?"exito":"error"}`,children:c}),e.jsx("h1",{children:"Registro de cuenta"}),e.jsxs("form",{onSubmit:w,children:[e.jsx("p",{children:"Nombre completo"}),e.jsx("input",{type:"text",name:"nombreCompleto",placeholder:"Nombre completo",value:f.nombreCompleto,onChange:j,required:!0,minLength:"2",maxLength:"50",pattern:"[A-Za-zÁÉÍÓÚáéíóúñÑ\\s]+",title:"Solo letras y espacios",className:i.current&&!/^[A-Za-zÁÉÍÓÚáéíóúñÑ\s]{2,50}$/.test(f.nombreCompleto)?"invalid":""}),i.current&&!/^[A-Za-zÁÉÍÓÚáéíóúñÑ\s]{2,50}$/.test(f.nombreCompleto)&&e.jsx("span",{className:"error-message",children:"Solo letras (mín. 2 caracteres)"}),e.jsx("p",{children:"Correo electrónico"}),e.jsx("input",{type:"email",name:"email",placeholder:"Correo electrónico",value:f.email,onChange:j,required:!0}),e.jsx("p",{children:"Contraseña"}),e.jsxs("label",{className:"password-label",children:[e.jsx("input",{type:t==="register"?"text":"password",name:"password",placeholder:"Contraseña",value:f.password,onChange:j,required:!0,minLength:"5"}),e.jsx("span",{className:"show-btn",onClick:()=>g(t==="register"?"":"register"),children:e.jsx("i",{className:t==="register"?"fas fa-eye-slash":"fas fa-eye"})})]}),e.jsx("p",{children:"Número de celular"}),e.jsx("input",{type:"tel",name:"telefono",placeholder:"Número de celular",value:f.telefono,onChange:j,required:!0,pattern:"9[0-9]{8}"}),e.jsx("button",{type:"submit",children:"Registrarse"}),e.jsxs("p",{className:"switch-form",children:["¿Ya tienes una cuenta?"," ",e.jsx("a",{onClick:()=>{m(!1),i.current=!1,o("")},children:"Inicia sesión aquí"})]})]})]}),e.jsxs("div",{className:`login-container ${p?"":"active"}`,children:[s&&e.jsx("div",{className:`alerta-login ${s.includes("exitoso")?"exito":"error"}`,children:s}),e.jsx("h1",{children:"Inicio de sesión"}),e.jsxs("form",{onSubmit:S,children:[e.jsx("p",{children:"Correo electrónico"}),e.jsx("input",{type:"email",name:"email",placeholder:"Correo electrónico",value:l.email,onChange:x,required:!0}),e.jsx("p",{children:"Contraseña"}),e.jsxs("label",{className:"password-label",children:[e.jsx("input",{type:t==="login"?"text":"password",name:"password",placeholder:"Contraseña",value:l.password,onChange:x,required:!0}),e.jsx("span",{className:"show-btn",onClick:()=>g(t==="login"?"":"login"),children:e.jsx("i",{className:t==="login"?"fas fa-eye-slash":"fas fa-eye"})})]}),e.jsx("button",{type:"submit",children:"Iniciar sesión"}),e.jsxs("p",{className:"switch-form",children:["¿No tienes cuenta?"," ",e.jsx("a",{onClick:()=>{m(!0),i.current=!1,y("")},children:"Regístrate ahora"})]})]})]})]})})]})})}export{q as default};
